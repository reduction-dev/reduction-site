#!/bin/bash
# This script fetches the latest tagged version of reduction from GitHub
# and updates the version.ts file

# Exit immediately if a command exits with a non-zero status
set -e

# Fetch the latest tag from GitHub
echo "Fetching latest reduction tag from GitHub..."
LATEST_TAG=$(curl -s https://api.github.com/repos/reduction-dev/reduction/tags | grep -m 1 "name" | cut -d '"' -f 4)

if [ -z "$LATEST_TAG" ]; then
  echo "Error: Failed to fetch the latest tag"
  exit 1
fi

# Strip the leading 'v' from the tag
VERSION=${LATEST_TAG#v}

# Update the versions.ts file
VERSIONS_FILE="./src/config/versions.ts"
cat > "$VERSIONS_FILE" << EOF
// This file is auto-generated by scripts/update-versions
// Do not edit manually

export const REDUCTION_VERSION = '$VERSION';
EOF

echo "Updated $VERSIONS_FILE to version $VERSION"
